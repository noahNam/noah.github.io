---
layout: post
title: Request processing flow & infrastructure
description: >
    요청 처리 흐름과 인프라스터럭처
sitemap: false
hide_last_modified: false
categories:
  - category
  - DDD
---


# Request processing flow

* toc
{:toc .large-only}

## Request processing flow
![UML](/assets/img/posts/ddd/request_proccesing_flow.png)
1. 표현 영역은 클라이언트에서 전송한 데이터 형식이 올바른지 검사하고 문제가 없다면 데이터를 이용해서 응용 서비스에 기능 실행을 위임한다. 이때 표현영역은 전송받은 데이터를 응용 서비스가 요구 하는 형식으로 변환해서 전달한다.
2. 응용 서비스는 도메인 모델을 이용해서 기능을 구현한다. 기능 구현에 필요한 도메인 객체를 레포지토리에서 가져와 실행하거나 신규 도메인 객체를 생성해서 레포지터리에 저장한다. 두 개 이상의 도메인 객체를 사용해서 구현하기도 한다.
3. 도메인 상태를 변경해야 할때 (예매하기, 예매 취소)와 같은 기능은 변경 상태가 DB등의 물리 저장소에 올바르게 반영되도록 트렌젝션 관리해야 한다.

## Infrastructure
- 인프라스트럭처는 표현 영역, 응용 영역, 도메인 영역을 지원한다.
- 도메인 객체의 영속성 처리, 트렌젝션, REST 클라이언트 등 다른 영역에서 필요로 하는 프레임워크, 구현기술, 보조 기능을 지원한다.
- 도메인 영역과 응용 영역에서 인프라스트럭쳐의 기능을 직접 구현하는 것보다 이 두 영역에서 정의한 인터페이스를 인프라스트럭쳐에서 구현하는 것이 시스템을 더 유연하고 테스트하기 쉽게 해준다.
  - 하지만 무조건 인프라스트럭쳐에 대한 의존을 없앨 경우, 자칫 구현을 더 복잡하고 어렵게 만들 수 있다.
  - 예를 들어 Spring의 @Transactional 어노테이션의 경우 한줄로 트랜젝션 관리를 할 수 있는데 코드에서 스프링에 대한 의존을 없애면 복잡한 스프링 설정을 사용해야 한다. 의존은 없앴지만 특별히 테스트의 이점이나 유연함은 없어지고 설정과 개발 시간만 늘어날 뿐이다.
  - 따라서, DIP의 장점을 해치지 않는 범위에서 응용 영역과 도메인 영역에서 구현 기술에 대한 의존을 가져가는 것이 나쁘지 않다.